<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.board.mapper.BoardMapper">
	
	<select id="getBoardList" resultType="BoardBean" parameterType="Paging">
		SELECT
			*
		FROM(
			SELECT
				ROWNUM AS "PAGENUM",
				T2.*
			FROM(
				SELECT
					ROWNUM AS "rNum",
					T.*
					FROM(
						SELECT
							BOARDNO,
							TITLE,
							CONTENTS,
							ID,
							NAME,
							REGDATE
						FROM BOARD
						ORDER BY REGDATE ASC
					) T
					ORDER BY ROWNUM DESC
				) T2
			)
			WHERE PAGENUM BETWEEN #{startNum} AND #{endNum}
	</select>
	
	<select id="getBoardDetail" resultType="BoardBean" parameterType="BoardBean">
		SELECT
			*
		FROM BOARD
		WHERE BOARDNO = #{boardNo}
	</select>
	
	<insert id="insertUpdateBoard" parameterType="BoardBean">
		MERGE INTO BOARD B
		USING (
			SELECT #{boardNo} AS "BOARDNO" FROM DUAL
		) TMP
		ON (
			B.BOARDNO = TMP.BOARDNO
		)
		WHEN MATCHED THEN
			UPDATE SET
				TITLE = #{title},
				CONTENTS = #{contents},
				ID = #{id},
				NAME = #{name},
				PASSWORD = #{password},
				LAST_UPDATE_DATE = SYSDATE
			WHERE BOARDNO = #{boardNo}
		WHEN NOT MATCHED THEN
			INSERT(
				BOARDNO,
				TITLE,
				CONTENTS,
				ID,
				NAME,
				PASSWORD,
				REGDATE
			) VALUES(
				BOARD_SEQ.NEXTVAL,
				#{title},
				#{contents},
				#{id},
				#{name},
				#{password},
				SYSDATE
			)
	</insert>
</mapper>